name: Build the resource pack

on:
  workflow_call:
    inputs:
      version_url:
        description: The download url for the Minecraft version json file to build the pack from
        required: true
        type: string
      version_name:
        description: The name of the Minecraft version to build the pack for
        required: true
        type: string
      is_full_release:
        description: Type of the release, true for a full release or false for a snapshot
        required: true
        type: boolean

jobs:
  build:
    runs-on: ubuntu-latest
    name: 'Build ${{ inputs.version_name }}'
    steps:
      - uses: actions/checkout@v4
        with:
          path: resource-pack
      - uses: actions/setup-go@v5
        with:
          go-version: '1.21'
      - name: Download and build dependencies
        run: |
          go build -C resource-pack/langmerge/ -o ../.. .

          git clone https://github.com/schmanguage/schmanguage-cli
          go build -C schmanguage-cli -o .. .

      - name: Get the ${{ inputs.version_name }} client
        run: |
          wget -O version.json ${{ inputs.version_url }}
          wget -O client.jar $(jq --compact-output --join-output .downloads.client.url version.json)
      - name: translate en_us
        run: |
          unzip -p client.jar assets/minecraft/lang/en_us.json > en_us.json
          ./schmanguage --type json en_us.json
          jq '.["language.code"] = (.["language.code"]|split("_")[0]+"_schm") | .["language.region"] = "Schmanguage"' en_us.json > en_schm.json
          ./langmerge en_us.json resource-pack/assets/schmanguage/lang/en_schm.json en_schm.json && rm en_schm.json
          ls -la
          cd resource-pack/ && git diff
